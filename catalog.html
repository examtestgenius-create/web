
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Exam papers — ExamTestGenius</title>
  <meta name="description" content="Browse CAPS past exam paper packs by grade, subject and term." />
  https://fonts.googleapis.com
  https://fonts.gstatic.com
  https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap
  assets/img/logo.svg
  <style>
    :root{--bg:#0b1220;--slate:#0f1b33;--text:#eaf0ff;--muted:#a7b4d6;--blue:#2f76ff;--border:rgba(255,255,255,.08);--shadow:0 10px 30px rgba(0,0,0,.35);--radius:16px;--max:1100px;--font:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:var(--font);background:radial-gradient(900px 500px at 20% -10%, rgba(47,118,255,.35), transparent 60%),radial-gradient(700px 500px at 80% 10%, rgba(47,118,255,.18), transparent 60%),var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:var(--max);margin:0 auto;padding:0 18px}
    .header{position:sticky;top:0;z-index:10;background:rgba(11,18,32,.72);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 0}
    .logo{display:flex;align-items:center;gap:10px;font-weight:900}
    .logo img{height:28px}
    .menu{display:flex;gap:18px;color:var(--muted);font-weight:600}
    .menu a:hover{color:var(--text)}
    .cta{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .section{padding:34px 0}
    .title{font-size:28px;margin:0 0 14px}
    .note{color:var(--muted);line-height:1.6}
    .filterbar{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0 16px}
    select,input[type='email'],input[type='tel']{
      width:100%;max-width:260px;background:rgba(255,255,255,.03);
      border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:12px;outline:none
    }
    label{display:grid;gap:6px;color:var(--muted);font-weight:700}
    .list{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px}
    @media (max-width:900px){.list{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:520px){.list{grid-template-columns:1fr}}
    .footer{border-top:1px solid var(--border);padding:18px 0;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}

    /* Dark dropdown patch */
    .filterbar select{
      background-color:#0b1220; color:#e5e7eb; border:1px solid #23304a;
      border-radius:12px; padding:10px 14px; appearance:none; -webkit-appearance:none; -moz-appearance:none;
      color-scheme:dark;
    }
    .filterbar select:focus{outline:2px solid #2F76FF; outline-offset:1px}
    .filterbar option{background-color:#0b1220; color:#e5e7eb}

    /* Simple card visuals */
    .pack-card{background:#0b1220;border:1px solid #23304a;border-radius:12px;padding:14px 16px;margin:10px 0}
    .pack-card h3{margin:0 0 6px;font-size:18px}
    .pack-card .btn{display:inline-block;margin-top:8px;padding:8px 14px;background:#2F76FF;color:#fff;border-radius:8px;text-decoration:none}
  </style>
</head>
<body>
  <header class="header">
    <div class="container nav">
      index.htmlassets/img/logo.svgExamTestGenius</a>
      <nav class="menu">
        index.html#guideGuide</a>
        catalog.htmlExam papers</a>
        downloads.htmlFree downloads</a>
        contact.htmlContact</a>
      </nav>
      <div class="cta">index.htmlHome</a></div>
    </div>
  </header>

  <section class="section">
    <div class="container">
      <h1 class="title">Browse CAPS Past Papers</h1>

      <div class="filterbar">
        <select data-filter="grade">
          <option value="">All grades</option>
          <option>12</option><option>11</option><option>10</option><option>9</option><option>8</option>
        </select>

        <select data-filter="subject">
          <option value="">All subjects</option>
        </select>

        <select data-filter="year">
          <option value="">All years</option>
        </select>

        <select data-filter="term">
          <option value="">All terms</option>
          <option>1</option><option>2</option><option>3</option><option>4</option>
        </select>
      </div>

      <div id="catalog-list" class="list"></div>
      <div id="catalog-note" class="note" style="margin-top:12px"></div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      Need help? Email mailto:examtestgenius@gmail.comexamtestgenius@gmail.com</a>
    </div>
  </footer>

  <script>
    // ====== CONFIG ======
    const CATALOG_URL =
      "https://script.google.com/macros/s/AKfycbzwE4xmXVI4oIbo_hDU4CXT9ZS1skIuUhelCAmBhUP35Q5C51v0Emtk5KnAj0Pb3V6E/exec?mode=catalog";

    // Hooks to existing elements in this page
    const selGrade   = document.querySelector('[data-filter="grade"]');
    const selSubject = document.querySelector('[data-filter="subject"]');
    const selYear    = document.querySelector('[data-filter="year"]');
    const selTerm    = document.querySelector('[data-filter="term"]');
    const listEl     = document.getElementById("catalog-list");
    const noteEl     = document.getElementById("catalog-note");

    let ALL_BUNDLES = [];

    // ====== UTIL ======
    const norm = (v) => (v ?? "").toString().trim();
    const up   = (v) => norm(v).toUpperCase();
    const isAll = (v) => v === "" || up(v) === "ALL";

    function uniqueSorted(values, { numeric=false } = {}) {
      const arr = [...new Set(values.map(norm).filter(Boolean))];
      return numeric ? arr.sort((a,b)=>Number(a)-Number(b))
                     : arr.sort((a,b)=>a.localeCompare(b, undefined, { numeric:true }));
    }

    function escapeHtml(s) {
      return String(s)
        .replaceAll("&","&amp;").replaceAll("<","&lt;")
        .replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    function setOptions(select, values, allLabel) {
      if (!select) return;
      const first =
        select.querySelector('option[value=""]')?.outerHTML ||
        select.querySelector("option")?.outerHTML ||
        `<option value="">${allLabel}</option>`;
      const html = values
        .map(v => `<option value="${escapeHtml(v)}">${escapeHtml(v)}</option>`)
        .join("");
      select.innerHTML = first + html;
    }

    // ====== FILTER + RENDER ======
    function currentFilters() {
      return {
        grade:   selGrade?.value   || "",
        subject: selSubject?.value || "",
        year:    selYear?.value    || "",
        term:    selTerm?.value    || ""
      };
    }

    function passFilters(b, f) {
      if (!isAll(f.grade)   && up(b.grade)   !== up(f.grade))   return false;
      if (!isAll(f.subject) && up(b.subject) !== up(f.subject)) return false;
      if (!isAll(f.year)    && up(b.year)    !== up(f.year))    return false;

      // Accept "1" and "T1" as equivalent
      const bt = up(String(b.term)).replace(/^T/, "");
      const ft = up(String(f.term)).replace(/^T/, "");
      if (!isAll(f.term) && bt !== ft) return false;

      return true;
    }

    function render(list) {
      noteEl.textContent = `Loaded ${list.length} pack${list.length === 1 ? "" : "s"}.`;

      if (!list.length) {
        listEl.innerHTML = `<p>No results for the current filter.</p>`;
        return;
      }

      const html = list.map(b => {
        const items = (b.items || []).map(it => `
          <li>
            ${escapeHtml(it.paperName || "Paper")} —
            ${escapeHtml(it.link)}Download</a>
          </li>
        `).join("");

        return `
          <article class="pack-card">
            <h3>${escapeHtml(b.title || b.sku)}</h3>
            <p><strong>SKU:</strong> ${escapeHtml(b.sku)}</p>
            <ul>${items}</ul>
            <div class="actions">
              #Buy</a>
            </div>
          </article>
        `;
      }).join("");

      listEl.innerHTML = html;
    }

    function applyFilters() {
      const f = currentFilters();
      render(ALL_BUNDLES.filter(b => passFilters(b, f)));
    }

    // ====== INIT ======
    async function initCatalog() {
      try {
        noteEl.textContent = "Loading catalog…";
        listEl.innerHTML = "";

        const res = await fetch(CATALOG_URL, { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        ALL_BUNDLES = Array.isArray(data?.bundles) ? data.bundles : [];

        // Populate Subjects & Years from data
        const subjects = uniqueSorted(ALL_BUNDLES.map(b => b.subject));
        const years    = uniqueSorted(ALL_BUNDLES.map(b => b.year), { numeric: true });
        setOptions(selSubject, subjects, "All subjects");
        setOptions(selYear, years, "All years");

        // Default filters = All
        if (selGrade)   selGrade.value   = "";
        if (selTerm)    selTerm.value    = "";
        if (selSubject) selSubject.value = "";
        if (selYear)    selYear.value    = "";

        render(ALL_BUNDLES);
        [selGrade, selSubject, selYear, selTerm].forEach(el => {
          if (el) el.addEventListener("change", applyFilters);
        });
      } catch (err) {
        console.error("Catalog load failed:", err);
        noteEl.textContent = "Could not load catalog.";
        listEl.innerHTML = `<p style="color:#f66">Error loading catalog. See console for details.</p>`;
      }
    }

    document.addEventListener("DOMContentLoaded", initCatalog);
  </script>
</body>
</html>
